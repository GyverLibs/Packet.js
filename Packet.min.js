var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{A:()=>s});class s{constructor(e=null){e instanceof Uint8Array?this.buffer=e:this.buffer=e instanceof s?e.buffer:e?new Uint8Array(e):new Uint8Array(0),this._updView(),this.bit=0}unpack(e){"string"==typeof e&&(e=e.split(","));let t=[],s=0;this.bit||=0;let r=e=>(this.bit&&(this.bit=0,s++),s+e<=this.buffer.length);try{for(let i of e){let e=this._parseType(i);switch(e.kind){case"u":case"i":if(e.len<8){if(this.bit+e.len>8&&!r(1))return null;let i=(1<<e.len)-1,n=this.buffer[s]>>this.bit&i;"i"==e.kind&&n&1<<e.len-1&&(n|=~i),t.push(n),this.bit+=e.len}else{if(!r(e.bytes))return null;t.push(this._getView(this.view,e.raw,s)),s+=e.bytes}break;case"f":if(!r(4))return null;t.push(this._getView(this.view,e.raw,s)),s+=4;break;case"'":case'"':if(!r(e.len))return null;t.push((new TextDecoder).decode(this.buffer.subarray(s,s+e.len))),s+=e.len;break;case"[":{if(!r(e.len*e.sub.bytes))return null;let i=[];for(let t=0;t<e.len;t++)i.push(this._getView(this.view,e.sub.raw,s+t*e.sub.bytes));t.push(i),s+=e.len*e.sub.bytes}break;case"b":if(!r(e.len))return null;t.push(this.buffer.subarray(s,s+e.len)),s+=e.len;break;default:t.push(null)}}this.buffer=this.buffer.subarray(s),this._updView()}catch(e){return console.error(e),null}return 1==t.length?t[0]:t}pack(e,t){let s=this._parseType(t);if(e instanceof Uint8Array){if(s.len){let t=new Uint8Array(s.len);t.set(e.subarray(0,s.len)),e=t}this._append(e)}else if("string"==typeof e)this.pack((new TextEncoder).encode(e),s.len?"b"+s.len:null);else if(Array.isArray(e)){t||(s=this._parseType(`[${e.length}]`));let r=new Uint8Array(s.len*s.sub.bytes),i=new DataView(r.buffer);for(let t=0;t<s.len;t++){let r=t<e.length?e[t]:0;this._setView(i,s.sub.raw,t*s.sub.bytes,r)}this._append(r)}else if(Number.isInteger(e))if(s.len>=8){let r=new Uint8Array(s.bytes),i=new DataView(r.buffer);this._setView(i,t,0,e),this._append(r)}else{(!this.bit||this.bit+s.len>8)&&this._append(new Uint8Array(1));let t=(1<<s.len)-1;this.buffer[this.buffer.length-1]|=(e&t)<<this.bit,this.bit+=s.len}else{let t=new Uint8Array(4),s=new DataView(t.buffer);this._setView(s,"f",0,e),this._append(t)}}static schema(e){let t=Object.keys(e),r=Object.values(e);return{pack(e){let i=new s;for(let s in t)i.pack(e[t[s]],r[s]);return i.buffer},unpack(e){let i=new s(e).unpack(r),n={};return t.forEach((e,t)=>n[e]=i[t]),n}}}_append(e){let t=new Uint8Array(this.buffer.length+e.length);t.set(this.buffer,0),t.set(e,this.buffer.length),this.buffer=t,this._updView(),this.bit=0}_setView(e,t,s,r){switch(t){case"i8":e.setInt8(s,r);break;case"u8":e.setUint8(s,r);break;case"i16":e.setInt16(s,r,!0);break;case"u16":e.setUint16(s,r,!0);break;case"i32":e.setInt32(s,r,!0);break;case"u32":e.setUint32(s,r,!0);break;case"f":e.setFloat32(s,r,!0)}}_getView(e,t,s){switch(t){case"i8":return e.getInt8(s);case"u8":return e.getUint8(s);case"i16":return e.getInt16(s,!0);case"u16":return e.getUint16(s,!0);case"i32":return e.getInt32(s,!0);case"u32":return e.getUint32(s,!0);case"f":return e.getFloat32(s,!0)}return null}_updView(){this.view=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength)}_parseType(e){let t=e?e[0]:"",s="f"==t?32:e&&parseInt(e.slice(1))||0;return{raw:e,kind:t,len:s,bytes:s>>3,sub:"["==t?this._parseType(e.split("]")[1]||"u8"):void 0}}}const r=t.A;export{r as default};